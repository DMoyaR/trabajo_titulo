<h2 class="ttl">Trabajo de T√≠tulo</h2>

<!-- Subir Entrega -->
<div class="card">
  <h3>Subir Entrega</h3>
  <div class="drop">üì• Bit√°coras, informes, anexos</div>
</div>

<!-- Postulaci√≥n de tema -->
<div class="card">
  <div class="row-head">
    <h3>Temas para Trabajo de titulo</h3>
    <button class="btn primary" (click)="togglePostulacion(true)">
      + Postular / Proponer tema
    </button>

  </div>
  <p class="muted">Completa el formulario para solicitar o proponer un tema.</p>

  <!-- Modal -->
  <div class="backdrop" *ngIf="showPostulacion()" (click)="togglePostulacion(false)"></div>
  <div class="modal" *ngIf="showPostulacion()" role="dialog" aria-modal="true">
    <div class="modal-head">
      <h4 class="ttl" style="margin:0;">Solicitud de Tema</h4>
      <button class="icon" (click)="togglePostulacion(false)" aria-label="Cerrar">‚úï</button>
    </div>

    <form [formGroup]="postulacionForm" (ngSubmit)="submitPostulacion()" class="grid" novalidate>
      <div class="field full">
        <label for="titulo">Nombre del tema <span class="req">*</span></label>
        <input id="titulo" type="text" formControlName="titulo" />
        <div class="err" *ngIf="hasError('titulo','required')">Obligatorio.</div>
        <div class="err" *ngIf="hasError('titulo','maxlength')">M√°x. 160 caracteres.</div>
      </div>

      <div class="field full">
        <label for="objetivo">Objetivo <span class="req">*</span></label>
        <input id="objetivo" type="text" formControlName="objetivo" />
        <div class="err" *ngIf="hasError('objetivo','required')">Obligatorio.</div>
        <div class="err" *ngIf="hasError('objetivo','maxlength')">M√°x. 300 caracteres.</div>
      </div>

      <div class="field full">
        <label for="descripcion">Breve descripci√≥n <span class="req">*</span></label>
        <textarea id="descripcion" rows="5" formControlName="descripcion"></textarea>
        <div class="err" *ngIf="hasError('descripcion','required')">Obligatorio.</div>
        <div class="err" *ngIf="hasError('descripcion','maxlength')">M√°x. 1200 caracteres.</div>
      </div>

      <div class="field">
        <label for="rama">Rama de la carrera <span class="req">*</span></label>
        <select id="rama" formControlName="rama">
          <option value="" disabled>Selecciona una rama</option>
          <option *ngFor="let r of ramas" [value]="r">{{ r }}</option>
        </select>
        <div class="err" *ngIf="hasError('rama','required')">Selecciona una rama.</div>
      </div>

      <div class="field">
        <label for="prof1">Profesor gu√≠a (Preferencia 1) <span class="req">*</span></label>
        <select id="prof1" formControlName="prof1">
          <option value="" disabled>Selecciona</option>
          <option *ngFor="let p of profesoresFiltrados()" [value]="p.id">{{ p.nombre }}</option>
        </select>
        <div class="err" *ngIf="hasError('prof1','required')">Selecciona una opci√≥n.</div>
      </div>

      <div class="field">
        <label for="prof2">Profesor gu√≠a (Preferencia 2)</label>
        <select id="prof2" formControlName="prof2">
          <option value="">(Opcional)</option>
          <option *ngFor="let p of profesoresFiltrados()" [value]="p.id">{{ p.nombre }}</option>
        </select>
      </div>

      <div class="field">
        <label for="prof3">Profesor gu√≠a (Preferencia 3)</label>
        <select id="prof3" formControlName="prof3">
          <option value="">(Opcional)</option>
          <option *ngFor="let p of profesoresFiltrados()" [value]="p.id">{{ p.nombre }}</option>
        </select>
      </div>

      <!-- CORREGIDO: usa getter o bracket notation -->
      <div class="field full" *ngIf="profesoresDuplicados">
        <span class="err">Las preferencias no pueden repetir al mismo profesor.</span>
      </div>

      <div class="actions full">
        <button type="button" class="btn light" (click)="togglePostulacion(false)">Cancelar</button>
        <button type="submit" class="btn primary">Enviar postulaci√≥n</button>
      </div>
    </form>
  </div>
</div>

<!-- Entregas recientes -->
<div class="card">
  <h3>Entregas recientes</h3>
  <ul class="list">
    <li *ngFor="let e of entregas()">
      {{e.nombre}} ‚Äî <span class="chip ok">{{e.estado}}</span> ({{e.fecha}})
    </li>
  </ul>
</div>