<section class="docentes-page">
  <div class="page-header">
    <div class="title-section">
      <h1 class="title">Panel del Coordinador</h1>
      <p class="subtitle">Sistema de Feedback Estudiantil - EvaluaciÃ³n Docente</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" type="button" (click)="exportExcel()">
        <i class="icon">ğŸ“Š</i>
        Exportar Excel
      </button>
      <button class="btn btn-secondary" type="button" (click)="exportPDF()">
        <i class="icon">ğŸ“„</i>
        Exportar PDF
      </button>
    </div>
  </div>

  <div class="filters-section">
    <div class="filter-group">
      <label for="cohorte">Cohorte</label>
      <select
        id="cohorte"
        class="filter-select"
        [(ngModel)]="selectedCohorte"
        (change)="applyFilters()"
      >
        <option value="">Seleccionar cohorte</option>
        <option *ngFor="let cohorte of cohortes" [value]="cohorte">{{ cohorte }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="semestre">Semestre</label>
      <select
        id="semestre"
        class="filter-select"
        [(ngModel)]="selectedSemestre"
        (change)="applyFilters()"
      >
        <option value="">Seleccionar semestre</option>
        <option *ngFor="let semestre of semestres" [value]="semestre">{{ semestre }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="proceso">Tipo de proceso</label>
      <select
        id="proceso"
        class="filter-select"
        [(ngModel)]="selectedProceso"
        (change)="applyFilters()"
      >
        <option value="">Seleccionar proceso</option>
        <option *ngFor="let proceso of procesos" [value]="proceso">{{ proceso }}</option>
      </select>
    </div>

    <div class="results-counter">
      <span>{{ filteredDocentes.length }} docentes encontrados</span>
    </div>
  </div>

  <div class="stats-section">
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-info">
        <h3>{{ getEstadisticasEncuestas().totalEstudiantes }}</h3>
        <p>Total Estudiantes</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <h3>{{ getEstadisticasEncuestas().totalEncuestasCompletadas }}</h3>
        <p>Encuestas Completadas</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-info">
        <h3>{{ getEstadisticasEncuestas().promedioCompletado }}%</h3>
        <p>Promedio Completado</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ¯</div>
      <div class="stat-info">
        <h3>{{ getEstadisticasEncuestas().completadas }}</h3>
        <p>Procesos Terminados</p>
      </div>
    </div>
  </div>

  <div class="table-container">
    <div class="table-header">
      <h2>GestiÃ³n de Feedback Docente</h2>
      <div class="table-stats">
        <span class="stat-item">Total: {{ getTotalDocentes() }}</span>
        <span class="stat-item">Completadas: {{ getEstadisticasEncuestas().completadas }}</span>
        <span class="stat-item">En Progreso: {{ getEstadisticasEncuestas().enProgreso }}</span>
      </div>
    </div>

    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th class="sortable">
              <span>Docente</span>
              <i class="sort-icon">â†•</i>
            </th>
            <th class="sortable">
              <span>NÃºmero de estudiantes</span>
              <i class="sort-icon">â†•</i>
            </th>
            <th class="sortable">
              <span>Inicio</span>
              <i class="sort-icon">â†•</i>
            </th>
            <th class="sortable">
              <span>Encuestas Completadas</span>
              <i class="sort-icon">â†•</i>
            </th>
            <th class="sortable">
              <span>Entrega Final</span>
              <i class="sort-icon">â†•</i>
            </th>
            <th class="sortable">
              <span>Cierre</span>
              <i class="sort-icon">â†•</i>
            </th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let docente of filteredDocentes; trackBy: trackByDocenteId"
            class="table-row"
            [class.high-completion]="docente.porcentajeCompletado >= 70"
            [class.low-completion]="docente.porcentajeCompletado < 40"
          >
            <td class="docente-cell">
              <div class="docente-info">
                <span class="docente-name">{{ docente.nombre }}</span>
                <small class="docente-details">{{ docente.cohorte }} - {{ docente.semestre }}</small>
              </div>
            </td>
            <td class="students-cell">
              <div class="students-count">
                <span class="count-number">{{ docente.numeroEstudiantes }}</span>
                <span class="count-label">estudiantes</span>
              </div>
            </td>
            <td class="date-cell">
              <div class="date-info">
                <span class="date-text">{{ formatDate(docente.fechaInicio) }}</span>
              </div>
            </td>
            <td class="progress-cell">
              <div class="progress-container">
                <div class="progress-bar">
                  <div
                    class="progress-fill"
                    [style.width.%]="docente.porcentajeCompletado"
                    [class]="getProgressStatus(docente.porcentajeCompletado)"
                  ></div>
                </div>
                <div class="progress-text">
                  <span class="completion-count">{{ docente.encuestasCompletadas }}/{{ docente.numeroEstudiantes }}</span>
                  <span class="completion-percentage">({{ docente.porcentajeCompletado }}%)</span>
                </div>
              </div>
            </td>
            <td class="date-cell">
              <div
                class="date-info"
                [class.date-warning]="isDateNearDeadline(docente.fechaEntregaFinal)"
                [class.date-overdue]="isDateOverdue(docente.fechaEntregaFinal)"
              >
                <span class="date-text">{{ formatDate(docente.fechaEntregaFinal) }}</span>
                <span *ngIf="isDateNearDeadline(docente.fechaEntregaFinal)" class="date-badge warning">PrÃ³ximo</span>
                <span *ngIf="isDateOverdue(docente.fechaEntregaFinal)" class="date-badge overdue">Vencido</span>
              </div>
            </td>
            <td class="date-cell">
              <div class="date-info">
                <span class="date-text">{{ formatDate(docente.fechaCierre) }}</span>
              </div>
            </td>
            <td class="actions-cell">
              <div class="action-buttons">
                <button
                  class="btn btn-primary btn-sm action-btn"
                  type="button"
                  (click)="verDetallesRespuestas(docente)"
                  [title]="'Ver detalles de feedback de ' + docente.nombre"
                >
                  <i class="icon">ğŸ‘</i>
                  Ver Detalles
                </button>
                <button
                  class="btn btn-secondary btn-sm action-btn"
                  type="button"
                  *ngIf="docente.porcentajeCompletado < 100"
                  (click)="enviarRecordatorio(docente)"
                  [title]="'Enviar recordatorio a estudiantes'"
                >
                  <i class="icon">ğŸ“§</i>
                  Recordatorio
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="filteredDocentes.length === 0" class="no-data-message">
        <div class="no-data-content">
          <i class="no-data-icon">ğŸ‘¨â€ğŸ«</i>
          <h3>No se encontraron docentes</h3>
          <p>Intenta cambiar los filtros para ver mÃ¡s resultados</p>
        </div>
      </div>
    </div>

    <div class="table-footer" *ngIf="filteredDocentes.length > 0">
      <div class="pagination-info">
        Mostrando {{ filteredDocentes.length }} de {{ docentes.length }} docentes
      </div>
      <button class="btn btn-secondary btn-sm" type="button" (click)="resetFilters()">
        <i class="icon">ğŸ”„</i>
        Limpiar Filtros
      </button>
    </div>
  </div>
</section>
